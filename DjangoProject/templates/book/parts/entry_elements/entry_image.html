<div class="entry-element bordered" id="image">
    {% if edit_mode %}
        {{ entry_form.image.errors }}
        <label for="{{ entry_form.image.id_for_label }}">
            <img id="imagePreview" src="{% if entry %}{% if entry.image %}{{ entry.image.url }}{% endif %}{% endif %}" alt="Upload Image">
        </label>
        {{ entry_form.image }}
    {% else %}
        {% if entry.image %}
            <img src="{{ entry.image.url }}" alt="No Image found">
        {% endif %}
    {% endif %}
</div>
<script>
  const fileInput = document.getElementById('{{ entry_form.image.id_for_label }}');
  const preview   = document.getElementById('imagePreview');

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) {
        preview.style.display = 'none';  // Hide instead of empty src
        return;
    }

    // Revoke previous URL if exists
    if (preview.dataset.prevUrl) {
        URL.revokeObjectURL(preview.dataset.prevUrl);
    }

    const url = URL.createObjectURL(file);
    preview.dataset.prevUrl = url;  // Store for cleanup
    preview.src = url;
    preview.style.display = 'block';
});
</script>